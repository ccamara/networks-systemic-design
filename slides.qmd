---
title: "Visualising complexity: Networks"
subtitle: "Creating and visualising Networks with Gephi"
author: "Carlos Cámara-Menoyo"
location: "Systemic Design | University of Warwick"
format: 
  revealjs:
    theme: [default, css/warwick.scss, css/warwick-fonts.scss]
    navigation-mode: vertical
    #controls-layout: bottom-right
    embed-resources: true
    logo: assets/figs/uow_logo.svg
title-slide-attributes:
  data-background-image: assets/figs/nastya-dulhiier-OKOOGO578eo-unsplash.jpg
  #data-background-size: contain
  data-background-color: "#0C0C0C"
  data-background-opacity: "0.8"
  data-notes: ""
---

```{r}
#| label: setup

library(dplyr)
library(knitr)
library(kableExtra)

nodes <- read.csv("data/starwars_nodes.csv")
edges <- read.csv("data/starwars_edges.csv")
```

#  {.center .smaller background-color="#343333"}

::::: columns
::: {.column width="50%"}
![](assets/figs/carlos.png){fig-alt="Carlos Cámara" fig-align="center" width="250"}

**Carlos Cámara-Menoyo**

*Senior Research Software Engineer,*

Centre for Interdisciplinary Methodologies

[carlos.camara\@warwick.ac.uk](mailto:carlos.camara@warwick.ac.uk){.email}
:::

::: {.column width="50%"}
![](assets/figs/greg.png){fig-alt="Greg McInerny" fig-align="center" width="250"}

**Greg McInerny**

*Associate Professor, Degree Convenor of the [MASc in Data Visualisation](https://warwick.ac.uk/fac/cross_fac/cim/apply-to-study/masters-programmes/visualisation/)*,

Centre for Interdisciplinary Methodologies

[G.McInerny\@warwick.ac.uk](mailto:Timothy.monteath@warwick.ac.uk)
:::
:::::

# Preamble

**Visualising Food-Energy-Water nexus**

::: notes
Let me start with the story of how I met Greg. It will make sense in a second, I promise.

I got to know him in a project (Creating Interfaces) where

Explain that we got to know each other in Creating interfaces. Explain the aim. You have been working with system, so Probably you know how complex they are, and how difficult it is to visualise them , either to gain understanding or communicating them. Today wwe will focus in one way of approaching the problem: creating and visualising networks
:::

I met Greg in a project where we were trying to understand how a particular type of complex system -that of Food-Energy-Water- was visualised, and create a representation of it.

![](assets/figs/fwe/Bijl2018_2.png)

![](assets/figs/fwe/nourishNourishFoodSystem2020_0.png)

##  {.center background-color="#F1977F"}

::: r-fit-text
Representing & visualising

a system is not trivial!
:::

Conceptualising and representing systems as a network is an option.

# Learning outcomes {.center background-color="#A499F4"}

Theory:

-   Have a basic understanding about what networks are

    -   As an object/model

    -   As a communication tool

Practice:

-   Turning our data into networks

-   Using dedicated software (Gephi) to visualise and enquiry and understand our data

::: {.callout-important appearance="simple"}
## Disclaimer

This is not a course on network analysis. Just visualisation/representation.
:::

# Overview {background-color="#A499F4"}

1.  Key concepts
2.  Guided tasks: I will be demonstrating how to use a software and you will need to replicate the same steps
3.  Bring Your Own Data (BYOD) Lab: here, you will be working autonomously with the dataset you've been producing.

# Key Concepts {background-color="#51D7C1"}

# Networks

::::: columns
::: {.column width="50%"}
Sets of entities (nodes) linked/connected by relationships (edges) that allow interaction, flow, or influence among them.

A **network** is a structure in which two or more objects (vertices/nodes) are linked one to another by some kind of relationship via an edge (or link).

-   Vertices can be connected to one or more vertices or unconnected (0 edges)
:::

::: {.column width="50%"}
![Königsberg circa 1736. Streets, bridges... can be considered networks.](assets/figs/bridges-with-water-600x418.png)
:::
:::::

# Graphs {.smaller}

::::: columns
::: {.column width="50%"}
A **graph** is a representation of a network. I.e. it's how networks are stored and represented.

The bare minimum information that a graph needs are:

-   [**Nodes** (or vertices)]{.highlight}: usually identified with

    -   a `unique ID`: a machine-readable unique identifier, shorter and unique for every node.

    -   a `Label`: a human-readable, longer text

    -   (optionally, but useful): a number of fields describing

-   [**Edges** (or links)]{.highlight}: defined as a pair of columns

    -   `source` the id of the node from where the edge starts

    -   `target` the if of the node where the edge ends

    -   optionally, we may want to add ids to edges, labels, and attributes.
:::

::: {.column width="50%"}
![Euler](assets/figs/euler-graph.png)
:::
:::::

##  {.smaller}

Let's see some examples:

```{r}
#| tbl-cap: "Top 10 nodes, according to `scenes`."
#| label: tbl-nodes-sample
nodes |> 
  # filter(Label %in% c("luke", "darth vader", "han", "leia", "boba fett")) |> 
  arrange(desc(scenes)) |> 
  head(10) |> 
  kable()
```

##  {.smaller}

And the edges attributes...

::::: columns
::: {.column width="50%"}
```{r}
#| tbl-cap: Example of interactions initiated by Han Solo.
#| label: tbl-edges-sample

edges |> 
  filter(Source == 70) |> 
  head(10) |> 
  kable()

```
:::

::: {.column width="50%"}
```{r}
#| tbl-cap: Example of interactions with Han Solo.
#| label: tbl-edges-sample-2

edges |> 
  filter(Target == 70) |> 
  head(10) |> 
  kable()

```
:::
:::::

# Systems, networks, graphs {.smaller}

Not all networks are systems, but systems can be abstracted as graphs and represented as networks

| Dimension | System | Network | Graph |
|------------------|------------------|------------------|------------------|
| **Definition** | An organized collection of physically or conceptually **interrelated components** that [together achieve a **purpose** or exhibit emergent behavior]{.highlight}. | A set of entities (nodes) linked by relationships (edges) that allow interaction, flow, or influence among them. | Mathematical model to store data. |
| **keyword** | Meaning | Representation | Abstraction |
| **Scope / Purpose** | Emphasizes *function* (inputs → outputs, goals, control). | Emphasizes *interaction* (flow of information, material, influence). | Abstraction. Purely *structural.* |
| **Examples** | Solar system, Digestive system, Surveillance system, | Families and friends, Social media interactions, Publications Co-Citation... | Files in `*.graphml`\`, `*.gexf`, a pair of `.csv` containing nodes and edges... |

# Software

We can use dedicated software to create, analyse, visualise and/or export graphs:

-   [Gephi](https://gephi.org/)
-   [retina](): online, interactive data visualisation
-   `igraph` (via `R` or `Python`) (out of scope)

## Gephi

::::: columns
::: {.column width="80%"}
[Gephi](https://gephi.org/) is an open-source network visualisation and analysis software. It is available for Windows, MacOS and Linux and widely used in academia and industry.

There are two variants:

1.  [Gephi Desktop](https://gephi.org/desktop/): a standalone application that you can install in your computer, and offers the full functionality of Gephi.
2.  [Gephi Lite](https://gephi.org/lite): a web-based version with limited functionality.
:::

::: {.column width="20%"}
![Gephi logo](https://gephi.org/icons/gephi-desktop-logo-inverted.svg){fig-align="right"}
:::
:::::

## 

![Gephi interface](https://gephi.org/images/screenshots/gephi-0.9.2-main-window.png)

# Guided task {background-color="#51D7C1"}

Using a provided network, we will be using Gephi to visualise and get insight

# The dataset: Star Wars Social Network {background-image="assets/figs/starwars_poster_2835756.jpg" background-opacity="0.4" background-color="#000000"}

Gabasova, E. (2016). Star Wars social network. DOI: <https://doi.org/10.5281/zenodo.1411479>.\n

Things to consider about this dataset:

-   two characters are connected if they speak together within the same scene.

-   the data contain characters and links from episodes I to VII.

-   data can be downloaded from HERE AND HERE

<!-- previous background https://cdn.europosters.eu/image/750/posters/star-wars-characters-i4731.jpg -->

## Enquiring the dataset

We may want to use this data to get a better understanding of the dynamics between the characters

-   Who are the most important characters?
    -   Overall, vs per episode
    -   Overall, dark vs light side of the Force
-   Who is interacting with the most important characters?
-   How often do characters from the same planet interact with each other?
    -   Do they need a protagonist to mediate?
-   How similar/different are the interactions between characters in the light side of the Force vs dark side?

# Loading a network in Gephi {.smaller}

:::::::: columns
:::::: {.column width="60%"}
From Gephi desktop:

1.  Click new project. Go to `File -> New Project` to create a new Gephi project file. Alternatively, you can use the link in the welcomedialog that pops up when you first open Gephi.

2.  Click on file and select `Import Spreadsheet`.

3.  Choose the `starwars-nodes.csv` file and choose open.

::: {.callout-tip appearance="simple"}
In the import dialogue box, check that all looks OK. You may also want to check if the data types are correct for each column.
:::

4.  Click on `Next and Finish` to see the import report.

::: {.callout-warning appearance="simple"}
Dataset needs at least two columns named `Id` and `Label`, otherwise an error will be triggered.
:::

5.  Go through the same (above) process of importing a spreadsheet but select the `starwars_edges.csv` file. It should recognise the file as an edges table.

::: {.callout-important appearance="simple"}
Make sure to **append this to the existing workspace.**
:::
::::::

::: {.column width="40%"}
{{< video https://www.youtube.com/embed/0xuWuFNVIwA?si=xsVpaKYzL3M3jFMU width="100%" height="400" >}}
:::
::::::::

##  {#default-graph data-menu-title="Default Network"}

![This is how our network looks by default. Pretty unexciting, and difficult to understand.](assets/figs/default-network.png)

## The data lab

Spend time exploring the data: [What do we know about each character?]{.highlight} [Are we missing any important character?]{.highlight}

![Our dataset, as seen in Gephi's Data Laboratory tab](assets/figs/gephi_data_laboratory.png)

## Task: Adding nodes {background-image="assets/figs/R2D2.webp" background-position="bottom right" background-size="20%"}

::::: columns
::: {.column width="50%"}
From the data lab, add a node with the following details:

1.  Label: `r2-d2`

2.  Scenes: `49`

3.  Affiliations: `Rebel Alliance`

4.  Locations: `Tatooine`

5.  species.droids: `Droid`

6.  Check every episode.
:::

::: {.column width="50%"}
![Adding a node from the Data lab](assets/figs/gephi_add_node.jpg)
:::
:::::

::: {.fragment .r-fit-text}
Why was R2D2 missing?
:::

# Do characters from different factions interact with each other?

We will be improving the network's appearance to visually answer these questions.

## Task: Adding labels

![Turning labels ON](assets/figs/gephi_labels.jpg)

## It looks worse than before! {.center}

Now it is even more cluttered than before and it is difficult to read or find meaningful information!

## Network Layout {.smaller}

::::: columns
::: {.column width="50%"}
Gephi has layout algorithms that we can use to explore the shapes within the network.

Each of them create visualisations that are easier to read and manipulate the data, but they also contain ideas of how the nodes are linked by the edges. Some of them are:

-   **Force Atlas**: useful for Small World/Scale-free networks, and is [useful for exploring the network]{.highlight} as it doesn’t introduce biases when plotting.
-   **Fruchterman-Reingold**: [useful to understand the topology of the graph]{.highlight}, as topologically near nodes are placed in the same vicinity, and far nodes are placed far from each other. Disconnected components are thus easy to visualize.
-   **OpenOrd**: This layout expects an undirected, weighted graph, and is very [useful to detect clusters]{.highlight}.
-   **Circular Layout**: this layout is simple but powerful: it orders the nodes by any metric or attribute you can think of. You can use this [to visualize the distribution of their nodes]{.highlight} with their links.
-   ...
:::

::: {.column width="50%"}
![Some layouts algorithms available in gephi. Some of them may require extra plugins (e.g. Geolayout) .](assets/figs/Gephi_Layouts.png)
:::
:::::

## Task: Change the network layout

::::: columns
::: {.column .smaller-text width="30%"}
From the layout pane, Choose several layouts and experiment with them

1.  Change layout types
2.  Adjust properties
3.  Choose one that you're comfortable with
4.  You can manually reposition some nodes, too! (Just click and drag)
:::

::: {.column width="70%"}
![Starwars graph with a Force Atlas 2 layout](assets/figs/gephi_layout.jpg)
:::
:::::

## Task: Change nodes' appearance

![Nodes, coloured by an attribute](assets/figs/gephi_nodes_partition.jpg)

# Who are the most important characters? {.text-fit}

## Task: Visual inspection

A visual inspection of the network can help us make quick decisions, but that will not always be possible or will be the best way to do it.

![Something](assets/figs/gephi_important_nodes.jpg)

## Changing the nodes' size

We can make more important nodes bigger than others.

But, [how can we define importance]{.highlight}?

::::: {.columns .fragment .smaller-text}
A possible approach could be using some of the existing attributes.

::: {.column width="50%"}
1.  Visit the Data explorer tab and look for an attribute that we could use to show importance
2.  On the Overview tab, choose the Appearance pane
3.  From the Nodes tab within the Appearance pane, click on the icon size
4.  Select Ranking
5.  Choose the **numeric attribute** you want to use to set the size
6.  Set the minimum size and max values. Attributes with intermediate values will be interpolated linearly.
:::

::: {.column width="50%"}
![Changing Node Size matching an attribute](assets/figs/nodes-size.png)
:::
:::::

##  {#chosen-poorly .smaller data-menu-title="Nope!" background-image="assets/figs/youhavechosenpoorly-indianajones.gif" background-color="#000" background-size="contain"}

::: {style="position:absolute;bottom:0;"}
I know, this is a character from another LucasFilms franchise
:::

##  {#our-data .center data-menu-title="An opportunity to reflect on our data"}

::: r-fit-text
Here, the dataset represents

**interactions between characters**,

not number of scenes!
:::

Importance should be based on *interactions*, but that's not an attribute on the nodes' table!

::: notes
I deliberately misled you to create an opportunity to reflect on our data and what it means, and how our methods need to be aligned with them.
:::

## Concept: Degree Centrality

::: {.columns .smaller-text}
The links between the nodes provide a structure for the network, but we need to be able to critically read them.

Reading and interpreting the edges is a vital skill in being able to interpret networks.
:::

::::: {.columns .smaller-text}
::: {.column width="50%"}
![Are all nodes equally important?](assets/figs/network_big.svg)
:::

::: {.column .fragment width="50%"}
Types of degrees:

-   **In-degree**: here we are looking at the way that the [number of degrees (or links) coming into a particular node]{.highlight}. Incoming nodes are passive as they show what links to the node in question.
-   **Out-degree**: here we look at the [number of links that nodes are generating]{.highlight}. These show us what is being actively linked from by a particular entity.
-   **Degree:** the total of links coming to or leaving a node. In a directed graph, it is the sum of In-degrees and out-degrees. In an undirected graph is the only measure that we will have, as there's no such distinction.
:::
:::::

## Concept: Weighted degrees {.smaller}

Are all the edges equally important?

::: fragment
Weighted degrees takes into account edges' importance (weight).

![Edges table, showing the Weight attribute. In this case, weight refers to the number of times each character interacts with each other.](assets/figs/gephi_edges_table.png.jpg){width="80%"}
:::

## Task: Computing degrees

::::: columns
::: {.column width="30%"}
1.  On Statistics Pane, click on `Run`\` next to "Average Degree"
2.  Go to the Data Loratory and see what has changed in the nodes tab
:::

::: {.column .smaller width="70%"}
![On Stats pane, click on "Run" next to "Average Degree"](assets/figs/gephi_stats_degree.jpg)
:::
:::::

## New options available!

Now that we know the degree centrality of each character, we can now several things:

1.  Check the attibute's table to see which are the most important characters
2.  Filtering data
3.  Changing the size of the nodes to visually display centrality

## Task: identify most important characters {.smaller}

::: fragment
From the data laboratory, we can sort the nodes' table by Degree/Weighted degree:

![Nodes, sorted by degree](assets/figs/gephi_nodes_degre.png.jpg)

![Nodes, sorted by weighted degree](assets/figs/gephi_nodes_degre_weighted.png.jpg)
:::

::: notes
Any guesses about who may be the most
:::

## Task: Filtering network

We will use the filter to hide irrelevant (i.e. unconnected) characters.

![Adding a "Degree" filter to hide unconnected nodes (degree 0). We could increase the minimum degree.](assets/figs/gephi_filter_degree.png)

## Task: Make nodes proportional to degree

![Nodes size proprtionally matched to their degree](assets/figs/gephi_nodes_ranking.png.jpg)

# Who interacts with the most important characters?

We are going to take this a step ahead.

## Task: Ego Filter

![Ego Filter](assets/figs/gephi_filter_ego.png)

# Exporting the visualisations

By now, we have a decent visualisation, but what if we want to improve it further? (e.g. adding titles and annotations, selective labels, composites, small multiples...)

Gephi can't do much more, but other editing software can!

## The Preview pane {.smaller}

![From here, we can export the graph as a raster or vector image!](assets/figs/gephi_preview.png)

#  {#the-way data-menu-title="This is the way" background-image="assets/figs/mando-way-this-is-the-way.gif" background-size="contain" background-color="#000000"}

::: notes
And this is the way we can use gephi to help us understand and explain complex, interrelated data. In the following weeks you'll explore with Greg and Nerea other ways to do it.
:::

# Wrap up {background-color="#F1977F"}

After this session, we've learnt:

-   What Graphs and Networks are

-   How to create a graph two datasets

-   How to visualise a graph within Gephi, using

    -   labels

    -   colours and sizes

    -   layouts

    -   filters

-   Exporting a network as svg

-   How to get a renewed understanding of our data

# Your turn! {background-color="#51D7C1"}

1.  Use gephi to create meaningful visualisations from your datasets
    1.  You may need to edit your data
2.  Use this dataset to try to address other questions:
    1.  Who are the most important characters per episode? / Dark vs Light side of the Force?

    2.  How often do characters from the same planet interact with each other?

        1.  Do they need a protagonist to mediate?

    3.  How similar/different are the interactions between characters in the light side of the Force vs dark side?
